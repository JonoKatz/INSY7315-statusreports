@model LeaseLogic.Models.PropertyModel
@{
    ViewData["Title"] = "Add Property";
}

<div class="container mt-5" style="max-width: 700px; font-family: Arial, sans-serif;">
    <h2 class="mb-4" style="color:#142943;">Add New Property</h2>

    <form asp-action="Add" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()

        <!-- Property Name -->
        <div class="mb-3">
            <label asp-for="Name" class="form-label">Property Name</label>
            <input asp-for="Name" class="form-control" placeholder="Enter property name" required />
        </div>

        <!-- Price -->
        <div class="mb-3">
            <label asp-for="Price" class="form-label">Price (R)</label>
            <input asp-for="Price" type="number" step="1" class="form-control" placeholder="Enter property price" value="@Model.Price" />
            <small class="text-muted">Price is only used when the property is occupied.</small>
        </div>

        <!-- Size -->
        <div class="mb-3">
            <label asp-for="Size" class="form-label">Size</label>
            <input asp-for="Size" class="form-control" placeholder="e.g. 120 sqm" required />
        </div>

        <!-- Location -->
        <div class="mb-3">
            <label asp-for="Location" class="form-label">Location</label>
            <input asp-for="Location" class="form-control" placeholder="Enter location" required />
        </div>

        <!-- Description -->
        <div class="mb-3">
            <label asp-for="Description" class="form-label">Description</label>
            <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter property description" required></textarea>
        </div>

        <!-- Image Previews -->
        <div id="imagePreview" class="d-flex flex-wrap gap-2 mb-2"></div>

        <!-- Image Upload -->
        <div class="mb-3">
            <label class="form-label">Upload Images</label>
            <input type="file" id="imageUpload" name="imageFiles" class="form-control" multiple />
            <small class="text-muted">Select one or more images. Each selected image will appear in the preview above.</small>
        </div>

        <!-- Status -->
        <div class="mb-3">
            <label asp-for="Status" class="form-label">Status</label>
            <select asp-for="Status" class="form-select">
                <option value="Available">Available</option>
                <option value="Occupied">Occupied</option>
                <option value="Pending">Pending</option>
            </select>
        </div>

        <button type="submit" class="btn text-white" style="background-color:#2572ad;">Add Property</button>
        <a asp-action="Index" class="btn btn-secondary ms-2">Cancel</a>
    </form>
</div>

<script>
    const imageInput = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');

    let filesArray = []; // Accumulate all selected files

    function updatePreview() {
        imagePreview.innerHTML = '';
        filesArray.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const container = document.createElement('div');
                container.style.position = 'relative';
                container.style.width = '100px';
                container.style.height = '100px';

                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '5px';
                container.appendChild(img);

                // Delete button
                const delBtn = document.createElement('button');
                delBtn.type = 'button';
                delBtn.className = 'btn btn-danger btn-sm position-absolute top-0 end-0';
                delBtn.style.fontSize = '12px';
                delBtn.innerText = 'X';
                delBtn.onclick = () => {
                    filesArray.splice(index, 1);
                    updatePreview();
                };
                container.appendChild(delBtn);

                imagePreview.appendChild(container);
            };
            reader.readAsDataURL(file);
        });

        // Update the input element with all files before submit
        const dt = new DataTransfer();
        filesArray.forEach(f => dt.items.add(f));
        imageInput.files = dt.files;
    }

    imageInput.addEventListener('change', function() {
        Array.from(this.files).forEach(f => filesArray.push(f));
        updatePreview();
        this.value = ''; // allow re-selecting same file
    });
</script>
